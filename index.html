<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EstimationPro - Construction Cost Estimation System</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/alpinejs/3.13.3/cdn.min.js" defer></script>
    <style>
        body { font-family: 'Inter', sans-serif; }
        .estimation-card { transition: all 0.3s ease; }
        .estimation-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        .measurement-row { transition: background-color 0.2s ease; }
        .measurement-row:hover { background-color: #f8fafc; }
        .abstract-row { border-left: 4px solid #3b82f6; }
        .total-row { background-color: #f1f5f9; font-weight: 600; }
        .drag-over { border: 2px dashed #3b82f6; background-color: #eff6ff; }
        .loading-spinner { animation: spin 1s linear infinite; }
        @keyframes spin { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .fade-in { animation: fadeIn 0.3s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body class="bg-gray-50" x-data="estimationApp()">
    <!-- Navigation Header -->
    <nav class="bg-white shadow-sm border-b border-gray-200 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-4">
                    <div class="flex items-center space-x-2">
                        <i class="fas fa-calculator text-blue-600 text-xl"></i>
                        <h1 class="text-xl font-bold text-gray-900">EstimationPro</h1>
                    </div>
                    <div class="hidden md:flex space-x-6">
                        <button @click="currentView = 'dashboard'" :class="{'text-blue-600 border-b-2 border-blue-600': currentView === 'dashboard'}" class="px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                            <i class="fas fa-tachometer-alt mr-1"></i> Dashboard
                        </button>
                        <button @click="currentView = 'estimates'" :class="{'text-blue-600 border-b-2 border-blue-600': currentView === 'estimates'}" class="px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                            <i class="fas fa-file-invoice mr-1"></i> Estimates
                        </button>
                        <button @click="currentView = 'ssr'" :class="{'text-blue-600 border-b-2 border-blue-600': currentView === 'ssr'}" class="px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                            <i class="fas fa-database mr-1"></i> SSR Database
                        </button>
                        <button @click="currentView = 'reports'" :class="{'text-blue-600 border-b-2 border-blue-600': currentView === 'reports'}" class="px-3 py-2 text-sm font-medium text-gray-700 hover:text-blue-600 transition-colors">
                            <i class="fas fa-chart-bar mr-1"></i> Reports
                        </button>
                    </div>
                </div>
                <div class="flex items-center space-x-3">
                    <button @click="showImportModal = true" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-upload mr-2"></i>Import Excel
                    </button>
                    <button @click="showExportModal = true" class="bg-green-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-green-700 transition-colors">
                        <i class="fas fa-download mr-2"></i>Export
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- Dashboard View -->
        <div x-show="currentView === 'dashboard'" class="fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Dashboard Overview</h2>
                <p class="text-gray-600">Monitor your estimation projects and system metrics</p>
            </div>

            <!-- Stats Cards -->
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm p-6 estimation-card">
                    <div class="flex items-center">
                        <div class="p-2 bg-blue-100 rounded-lg">
                            <i class="fas fa-file-invoice text-blue-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Estimates</p>
                            <p class="text-2xl font-bold text-gray-900" x-text="estimates.length">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm p-6 estimation-card">
                    <div class="flex items-center">
                        <div class="p-2 bg-green-100 rounded-lg">
                            <i class="fas fa-calculator text-green-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Active Projects</p>
                            <p class="text-2xl font-bold text-gray-900" x-text="activeProjects">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm p-6 estimation-card">
                    <div class="flex items-center">
                        <div class="p-2 bg-yellow-100 rounded-lg">
                            <i class="fas fa-database text-yellow-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">SSR Items</p>
                            <p class="text-2xl font-bold text-gray-900" x-text="ssrItems.length">0</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-white rounded-lg shadow-sm p-6 estimation-card">
                    <div class="flex items-center">
                        <div class="p-2 bg-purple-100 rounded-lg">
                            <i class="fas fa-chart-line text-purple-600 text-xl"></i>
                        </div>
                        <div class="ml-4">
                            <p class="text-sm font-medium text-gray-600">Total Value</p>
                            <p class="text-2xl font-bold text-gray-900" x-text="'₹' + formatCurrency(totalValue)">₹0</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Recent Activity -->
            <div class="bg-white rounded-lg shadow-sm">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Recent Activity</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4" x-show="recentActivity.length > 0">
                        <template x-for="activity in recentActivity" :key="activity.id">
                            <div class="flex items-start space-x-3">
                                <div class="flex-shrink-0">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i :class="activity.icon" class="text-blue-600 text-sm"></i>
                                    </div>
                                </div>
                                <div class="flex-1">
                                    <p class="text-sm text-gray-900" x-text="activity.description"></p>
                                    <p class="text-xs text-gray-500" x-text="activity.timestamp"></p>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div x-show="recentActivity.length === 0" class="text-center text-gray-500 py-8">
                        <i class="fas fa-inbox text-4xl mb-4"></i>
                        <p>No recent activity</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Estimates View -->
        <div x-show="currentView === 'estimates'" class="fade-in">
            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">Cost Estimates</h2>
                        <p class="text-gray-600">Manage your construction cost estimates</p>
                    </div>
                    <button @click="createNewEstimate()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>New Estimate
                    </button>
                </div>
            </div>

            <!-- Estimate List -->
            <div class="bg-white rounded-lg shadow-sm">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">All Estimates</h3>
                        <div class="flex space-x-2">
                            <input type="text" x-model="searchQuery" placeholder="Search estimates..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <select x-model="filterType" class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">All Types</option>
                                <option value="civil">Civil Work</option>
                                <option value="sanitary">Sanitary Work</option>
                                <option value="electrical">Electrical Work</option>
                                <option value="landscape">Landscape Work</option>
                            </select>
                        </div>
                    </div>
                </div>
                <div class="divide-y divide-gray-200">
                    <template x-for="estimate in filteredEstimates" :key="estimate.id">
                        <div class="p-6 hover:bg-gray-50 cursor-pointer" @click="openEstimate(estimate)">
                            <div class="flex items-center justify-between">
                                <div class="flex-1">
                                    <div class="flex items-center space-x-3">
                                        <h4 class="text-lg font-semibold text-gray-900" x-text="estimate.name"></h4>
                                        <span :class="getTypeBadge(estimate.type)" x-text="estimate.type"></span>
                                    </div>
                                    <p class="text-sm text-gray-600 mt-1" x-text="estimate.description"></p>
                                    <div class="flex items-center space-x-4 mt-2">
                                        <span class="text-sm text-gray-500">
                                            <i class="fas fa-calendar mr-1"></i>
                                            <span x-text="formatDate(estimate.createdDate)"></span>
                                        </span>
                                        <span class="text-sm text-gray-500">
                                            <i class="fas fa-list mr-1"></i>
                                            <span x-text="estimate.parts.length + ' parts'"></span>
                                        </span>
                                    </div>
                                </div>
                                <div class="text-right">
                                    <p class="text-lg font-bold text-gray-900" x-text="'₹' + formatCurrency(estimate.totalAmount)"></p>
                                    <div class="flex space-x-2 mt-2">
                                        <button @click.stop="duplicateEstimate(estimate)" class="text-blue-600 hover:text-blue-800 text-sm">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                        <button @click.stop="deleteEstimate(estimate)" class="text-red-600 hover:text-red-800 text-sm">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </template>
                </div>
            </div>
        </div>

        <!-- SSR Database View -->
        <div x-show="currentView === 'ssr'" class="fade-in">
            <div class="mb-8">
                <div class="flex justify-between items-center">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900 mb-2">SSR Database</h2>
                        <p class="text-gray-600">Standard Schedule of Rates management</p>
                    </div>
                    <button @click="showAddSSRModal = true" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700 transition-colors">
                        <i class="fas fa-plus mr-2"></i>Add SSR Item
                    </button>
                </div>
            </div>

            <!-- SSR Items Table -->
            <div class="bg-white rounded-lg shadow-sm overflow-hidden">
                <div class="px-6 py-4 border-b border-gray-200">
                    <div class="flex justify-between items-center">
                        <h3 class="text-lg font-semibold text-gray-900">SSR Items</h3>
                        <input type="text" x-model="ssrSearchQuery" placeholder="Search SSR items..." class="px-3 py-2 border border-gray-300 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                </div>
                <div class="overflow-x-auto">
                    <table class="min-w-full divide-y divide-gray-200">
                        <thead class="bg-gray-50">
                            <tr>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Code</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Description</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unit</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Rate (₹)</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Category</th>
                                <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody class="bg-white divide-y divide-gray-200">
                            <template x-for="item in filteredSSRItems" :key="item.id">
                                <tr class="hover:bg-gray-50">
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900" x-text="item.code"></td>
                                    <td class="px-6 py-4 text-sm text-gray-900" x-text="item.description"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="item.unit"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="formatCurrency(item.rate)"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900" x-text="item.category"></td>
                                    <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                                        <button @click="editSSRItem(item)" class="text-blue-600 hover:text-blue-900 mr-3">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button @click="deleteSSRItem(item)" class="text-red-600 hover:text-red-900">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            </template>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Reports View -->
        <div x-show="currentView === 'reports'" class="fade-in">
            <div class="mb-8">
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Reports & Analytics</h2>
                <p class="text-gray-600">Comprehensive analysis of your estimation data</p>
            </div>

            <!-- Charts Section -->
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Estimates by Type</h3>
                    <canvas id="estimatesByTypeChart" width="400" height="300"></canvas>
                </div>
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-900 mb-4">Cost Distribution</h3>
                    <canvas id="costDistributionChart" width="400" height="300"></canvas>
                </div>
            </div>

            <!-- Export History -->
            <div class="bg-white rounded-lg shadow-sm">
                <div class="px-6 py-4 border-b border-gray-200">
                    <h3 class="text-lg font-semibold text-gray-900">Export History</h3>
                </div>
                <div class="p-6">
                    <div class="space-y-4" x-show="exportHistory.length > 0">
                        <template x-for="export in exportHistory" :key="export.id">
                            <div class="flex items-center justify-between p-4 bg-gray-50 rounded-lg">
                                <div class="flex items-center space-x-3">
                                    <div class="w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center">
                                        <i :class="getExportIcon(export.format)" class="text-blue-600 text-sm"></i>
                                    </div>
                                    <div>
                                        <p class="text-sm font-medium text-gray-900" x-text="export.filename"></p>
                                        <p class="text-xs text-gray-500" x-text="export.timestamp"></p>
                                    </div>
                                </div>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs bg-gray-200 text-gray-700 px-2 py-1 rounded" x-text="export.format.toUpperCase()"></span>
                                    <button @click="downloadExport(export)" class="text-blue-600 hover:text-blue-800 text-sm">
                                        <i class="fas fa-download"></i>
                                    </button>
                                </div>
                            </div>
                        </template>
                    </div>
                    <div x-show="exportHistory.length === 0" class="text-center text-gray-500 py-8">
                        <i class="fas fa-file-export text-4xl mb-4"></i>
                        <p>No exports yet</p>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Import Modal -->
    <div x-show="showImportModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Import Excel File</h3>
                    <button @click="showImportModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-2">
                    <div class="border-2 border-dashed border-gray-300 rounded-lg p-6 text-center" 
                         :class="{'drag-over': isDragging}"
                         @dragover.prevent="isDragging = true"
                         @dragleave.prevent="isDragging = false"
                         @drop.prevent="handleFileDrop($event)">
                        <input type="file" id="excelFile" accept=".xlsx,.xls,.xlsm" @change="handleFileSelect($event)" class="hidden">
                        <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 mb-4"></i>
                        <p class="text-gray-600 mb-2">Drop Excel file here or</p>
                        <button @click="document.getElementById('excelFile').click()" class="bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700">
                            Choose File
                        </button>
                        <p class="text-xs text-gray-500 mt-2">Supports .xlsx, .xls, .xlsm formats</p>
                    </div>
                    <div x-show="importProgress > 0" class="mt-4">
                        <div class="bg-gray-200 rounded-full h-2">
                            <div class="bg-blue-600 h-2 rounded-full transition-all duration-300" :style="`width: ${importProgress}%`"></div>
                        </div>
                        <p class="text-sm text-gray-600 mt-2" x-text="importStatus"></p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Export Modal -->
    <div x-show="showExportModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
        <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-4">
                    <h3 class="text-lg font-medium text-gray-900">Export Estimate</h3>
                    <button @click="showExportModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="mt-2 space-y-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Export Format</label>
                        <select x-model="exportFormat" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                            <option value="pdf">PDF Document</option>
                            <option value="excel">Excel Workbook</option>
                            <option value="html">HTML Report</option>
                            <option value="csv">CSV Package</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Filename</label>
                        <input type="text" x-model="exportFilename" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                    </div>
                    <div class="flex space-x-3">
                        <button @click="exportEstimate()" class="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg text-sm font-medium hover:bg-blue-700">
                            Export
                        </button>
                        <button @click="showExportModal = false" class="flex-1 bg-gray-300 text-gray-700 px-4 py-2 rounded-lg text-sm font-medium hover:bg-gray-400">
                            Cancel
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Estimate Detail Modal -->
    <div x-show="showEstimateModal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50" style="display: none;">
        <div class="relative top-10 mx-auto p-5 border w-full max-w-6xl shadow-lg rounded-md bg-white">
            <div class="mt-3">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-xl font-semibold text-gray-900" x-text="currentEstimate?.name"></h3>
                    <button @click="showEstimateModal = false" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                
                <div class="mb-6">
                    <div class="flex justify-between items-center mb-4">
                        <div class="flex space-x-4 border-b border-gray-200">
                            <button @click="estimateTab = 'general'" :class="{'border-b-2 border-blue-600 text-blue-600': estimateTab === 'general'}" class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-blue-600">
                                General Abstract
                            </button>
                            <button @click="estimateTab = 'corrections'" :class="{'border-b-2 border-blue-600 text-blue-600': estimateTab === 'corrections'}" class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-blue-600">
                                <i class="fas fa-edit mr-1"></i>Minor Corrections
                            </button>
                            <template x-for="part in currentEstimate?.parts" :key="part.id">
                                <button @click="estimateTab = part.id" :class="{'border-b-2 border-blue-600 text-blue-600': estimateTab === part.id}" class="px-4 py-2 text-sm font-medium text-gray-700 hover:text-blue-600" x-text="part.name"></button>
                            </template>
                        </div>
                        <div class="flex space-x-2">
                            <button @click="validateEstimate()" class="bg-green-600 text-white px-3 py-1 rounded text-sm hover:bg-green-700" title="Validate Estimate">
                                <i class="fas fa-check mr-1"></i>Validate
                            </button>
                            <button @click="showImportModal = true" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700" title="Re-import">
                                <i class="fas fa-redo mr-1"></i>Re-import
                            </button>
                        </div>
                    </div>
                </div>

                <!-- General Abstract Tab -->
                <div x-show="estimateTab === 'general'" class="fade-in">
                    <div class="bg-gray-50 rounded-lg p-4 mb-4">
                        <h4 class="font-semibold text-gray-900 mb-2">General Abstract Summary</h4>
                        <div class="grid grid-cols-2 md:grid-cols-4 gap-4">
                            <div>
                                <p class="text-sm text-gray-600">Total Parts</p>
                                <p class="text-lg font-bold" x-text="currentEstimate?.parts?.length || 0"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Total Items</p>
                                <p class="text-lg font-bold" x-text="getTotalItems()"></p>
                            </div>
                            <div>
                                <p class="text-sm text-gray-600">Total Amount</p>
                                <p class="text-lg font-bold text-green-600" x-text="'₹' + formatCurrency(currentEstimate?.totalAmount || 0)"></p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="min-w-full divide-y divide-gray-200">
                            <thead class="bg-gray-50">
                                <tr>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Part Name</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Items</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Total Amount</th>
                                    <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white divide-y divide-gray-200">
                                <template x-for="part in currentEstimate?.parts" :key="part.id">
                                    <tr class="hover:bg-gray-50">
                                        <td class="px-6 py-4 text-sm font-medium text-gray-900" x-text="part.name"></td>
                                        <td class="px-6 py-4 text-sm text-gray-900" x-text="part.items?.length || 0"></td>
                                        <td class="px-6 py-4 text-sm font-semibold text-gray-900" x-text="'₹' + formatCurrency(getPartTotal(part))"></td>
                                        <td class="px-6 py-4 text-sm">
                                            <button @click="estimateTab = part.id" class="text-blue-600 hover:text-blue-900">View Details</button>
                                        </td>
                                    </tr>
                                </template>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- Part Detail Tab -->
                <template x-for="part in currentEstimate?.parts" :key="part.id">
                    <div x-show="estimateTab === part.id" class="fade-in">
                        <div class="mb-4 flex justify-between items-center">
                            <h4 class="text-lg font-semibold text-gray-900" x-text="part.name"></h4>
                            <div class="space-x-2">
                                <button @click="addItemToPart(part)" class="bg-blue-600 text-white px-3 py-1 rounded text-sm hover:bg-blue-700">
                                    <i class="fas fa-plus mr-1"></i>Add Item
                                </button>
                                <button @click="deletePart(part)" class="bg-red-600 text-white px-3 py-1 rounded text-sm hover:bg-red-700">
                                    <i class="fas fa-trash mr-1"></i>Delete Part
                                </button>
                            </div>
                        </div>

                        <!-- Measurement Sheet -->
                        <div class="mb-6">
                            <h5 class="font-semibold text-gray-900 mb-3">Measurement Sheet</h5>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Unit</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <template x-for="item in part.measurementItems" :key="item.id">
                                            <tr class="measurement-row">
                                                <td class="px-4 py-2 text-sm text-gray-900">
                                                    <input type="text" x-model="item.description" class="w-full border-0 bg-transparent focus:outline-none" @blur="updateCalculations()">
                                                </td>
                                                <td class="px-4 py-2 text-sm text-gray-900">
                                                    <select x-model="item.unit" class="border-0 bg-transparent focus:outline-none" @change="updateCalculations()">
                                                        <option value="RM">RM</option>
                                                        <option value="Cum">Cum</option>
                                                        <option value="Sqm">Sqm</option>
                                                        <option value="Nos">Nos</option>
                                                        <option value="Kg">Kg</option>
                                                        <option value="Ton">Ton</option>
                                                    </select>
                                                </td>
                                                <td class="px-4 py-2 text-sm text-gray-900">
                                                    <input type="number" x-model="item.quantity" class="w-20 border-0 bg-transparent focus:outline-none" @input="updateCalculations()" step="0.01">
                                                </td>
                                                <td class="px-4 py-2 text-sm">
                                                    <button @click="deleteMeasurementItem(part, item)" class="text-red-600 hover:text-red-800">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Abstract of Cost -->
                        <div>
                            <h5 class="font-semibold text-gray-900 mb-3">Abstract of Cost</h5>
                            <div class="overflow-x-auto">
                                <table class="min-w-full divide-y divide-gray-200">
                                    <thead class="bg-gray-50">
                                        <tr>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Description</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Unit</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Quantity</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Rate (₹)</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Amount (₹)</th>
                                            <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase">Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody class="bg-white divide-y divide-gray-200">
                                        <template x-for="item in part.abstractItems" :key="item.id">
                                            <tr class="abstract-row">
                                                <td class="px-4 py-2 text-sm text-gray-900" x-text="item.description"></td>
                                                <td class="px-4 py-2 text-sm text-gray-900" x-text="item.unit"></td>
                                                <td class="px-4 py-2 text-sm text-gray-900" x-text="formatNumber(item.quantity)"></td>
                                                <td class="px-4 py-2 text-sm text-gray-900">
                                                    <input type="number" x-model="item.rate" class="w-20 border-0 bg-transparent focus:outline-none" @input="updateCalculations()" step="0.01">
                                                </td>
                                                <td class="px-4 py-2 text-sm font-semibold text-gray-900" x-text="formatCurrency(item.amount)"></td>
                                                <td class="px-4 py-2 text-sm">
                                                    <button @click="deleteAbstractItem(part, item)" class="text-red-600 hover:text-red-800">
                                                        <i class="fas fa-trash"></i>
                                                    </button>
                                                </td>
                                            </tr>
                                        </template>
                                        <tr class="total-row">
                                            <td colspan="4" class="px-4 py-3 text-sm font-bold text-gray-900 text-right">Total:</td>
                                            <td class="px-4 py-3 text-sm font-bold text-green-600" x-text="'₹' + formatCurrency(getPartTotal(part))"></td>
                                            <td></td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </template>

                <!-- Minor Corrections Tab -->
                <div x-show="estimateTab === 'corrections'" class="fade-in">
                    <div class="mb-6">
                        <h4 class="text-lg font-semibold text-gray-900 mb-4">
                            <i class="fas fa-tools mr-2"></i>Minor Corrections & Adjustments
                        </h4>
                        <p class="text-gray-600 mb-6">Quickly fix common issues in imported estimates without re-importing the entire file.</p>
                        
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            <!-- Quick Fixes -->
                            <div class="bg-white border border-gray-200 rounded-lg p-4">
                                <h5 class="font-semibold text-gray-900 mb-3">Quick Fixes</h5>
                                <div class="space-y-3">
                                    <button @click="fixMissingDescriptions()" class="w-full bg-blue-50 text-blue-700 px-4 py-2 rounded text-sm hover:bg-blue-100 text-left">
                                        <i class="fas fa-text-width mr-2"></i>Fix Missing Descriptions
                                    </button>
                                    <button @click="fixZeroQuantities()" class="w-full bg-green-50 text-green-700 px-4 py-2 rounded text-sm hover:bg-green-100 text-left">
                                        <i class="fas fa-calculator mr-2"></i>Set Zero Quantities to 1
                                    </button>
                                    <button @click="fixMissingUnits()" class="w-full bg-yellow-50 text-yellow-700 px-4 py-2 rounded text-sm hover:bg-yellow-100 text-left">
                                        <i class="fas fa-ruler mr-2"></i>Fill Missing Units (Cum)
                                    </button>
                                    <button @click="standardizeDescriptions()" class="w-full bg-purple-50 text-purple-700 px-4 py-2 rounded text-sm hover:bg-purple-100 text-left">
                                        <i class="fas fa-align-left mr-2"></i>Standardize Descriptions
                                    </button>
                                </div>
                            </div>
                            
                            <!-- Validation Results -->
                            <div class="bg-white border border-gray-200 rounded-lg p-4">
                                <h5 class="font-semibold text-gray-900 mb-3">Validation Results</h5>
                                <div class="space-y-3" x-show="correctionIssues.length > 0">
                                    <template x-for="issue in correctionIssues" :key="issue.id">
                                        <div class="p-3 rounded border-l-4" :class="issue.type === 'error' ? 'bg-red-50 border-red-400' : 'bg-yellow-50 border-yellow-400'">
                                            <div class="flex items-center justify-between">
                                                <span class="text-sm font-medium" x-text="issue.message"></span>
                                                <button @click="fixIssue(issue)" class="text-xs bg-blue-600 text-white px-2 py-1 rounded hover:bg-blue-700">
                                                    Fix
                                                </button>
                                            </div>
                                            <div class="text-xs text-gray-600 mt-1" x-text="`Location: ${issue.location}`"></div>
                                        </div>
                                    </template>
                                </div>
                                <div x-show="correctionIssues.length === 0" class="text-center text-gray-500 py-4">
                                    <i class="fas fa-check-circle text-2xl mb-2 text-green-500"></i>
                                    <p>No issues found!</p>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Bulk Operations -->
                        <div class="mt-6 bg-gray-50 rounded-lg p-4">
                            <h5 class="font-semibold text-gray-900 mb-3">Bulk Operations</h5>
                            <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Find & Replace</label>
                                    <input type="text" x-model="findText" placeholder="Find text..." class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Replace With</label>
                                    <input type="text" x-model="replaceText" placeholder="Replace with..." class="w-full px-3 py-2 border border-gray-300 rounded text-sm">
                                </div>
                                <div class="flex items-end">
                                    <button @click="bulkReplace()" class="bg-blue-600 text-white px-4 py-2 rounded text-sm hover:bg-blue-700">
                                        <i class="fas fa-exchange-alt mr-1"></i>Replace All
                                    </button>
                                </div>
                            </div>
                        </div>
                        
                        <!-- Summary -->
                        <div class="mt-6 bg-blue-50 rounded-lg p-4">
                            <h5 class="font-semibold text-blue-900 mb-2">Summary</h5>
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 text-sm">
                                <div>
                                    <span class="text-blue-600">Total Items:</span>
                                    <span class="font-semibold" x-text="getTotalItems()"></span>
                                </div>
                                <div>
                                    <span class="text-blue-600">Issues Found:</span>
                                    <span class="font-semibold" x-text="correctionIssues.length"></span>
                                </div>
                                <div>
                                    <span class="text-blue-600">Parts:</span>
                                    <span class="font-semibold" x-text="currentEstimate?.parts?.length || 0"></span>
                                </div>
                                <div>
                                    <span class="text-blue-600">Total Amount:</span>
                                    <span class="font-semibold" x-text="'₹' + formatCurrency(currentEstimate?.totalAmount || 0)"></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="text-center">
                <p class="text-gray-600">&copy; 2024 EstimationPro. Professional construction cost estimation system.</p>
            </div>
        </div>
    </footer>

    <script src="app.js"></script>
</body>
</html>